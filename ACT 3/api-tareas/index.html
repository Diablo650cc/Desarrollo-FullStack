<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>API de Tareas</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <h1>Gestor de Tareas</h1>
    
    <div id="alert"></div>

    <h2>Crear Tarea</h2>
    <div class="form-group">
      <label>Titulo:</label>
      <input type="text" id="titulo" placeholder="Ej: Comprar leche">
    </div>
    <div class="form-group">
      <label>Descripcion:</label>
      <textarea id="descripcion" placeholder="Ej: Ir al supermercado"></textarea>
    </div>
    <button onclick="crearTarea()">Agregar Tarea</button>

    <h2 style="margin-top: 30px;">Mis Tareas</h2>
    <div id="tareas"></div>
  </div>

  <script>
    const API_URL = 'http://localhost:3000';

    function mostrarAlerta(mensaje, tipo) {
      const alert = document.getElementById('alert');
      alert.innerHTML = `<div class="alert alert-${tipo}">${mensaje}</div>`;
      setTimeout(() => { alert.innerHTML = ''; }, 3000);
    }

    async function cargarTareas() {
      try {
        const response = await fetch(`${API_URL}/tareas`);
        const tareas = await response.json();
        
        const tareasDiv = document.getElementById('tareas');
        if (tareas.length === 0) {
          tareasDiv.innerHTML = '<div class="empty">No hay tareas</div>';
          return;
        }

        tareasDiv.innerHTML = tareas.map(t => `
          <div class="task">
            <h3>${t.titulo}</h3>
            <p>${t.descripcion}</p>
            <small>Creado: ${new Date(t.createdAt).toLocaleString()}</small>
            <div class="task-buttons">
              <button onclick="editarTarea('${t.id}')">Editar</button>
              <button class="btn-delete" onclick="eliminarTarea('${t.id}')">Eliminar</button>
            </div>
          </div>
        `).join('');
      } catch (error) {
        mostrarAlerta('Error: ' + error.message, 'error');
      }
    }

    async function crearTarea() {
      const titulo = document.getElementById('titulo').value.trim();
      const descripcion = document.getElementById('descripcion').value.trim();

      if (!titulo || !descripcion) {
        mostrarAlerta('Completa todos los campos', 'error');
        return;
      }

      try {
        const response = await fetch(`${API_URL}/tareas`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ titulo, descripcion })
        });

        if (!response.ok) {
          const data = await response.json();
          throw new Error(data.error);
        }

        mostrarAlerta('Tarea creada', 'success');
        document.getElementById('titulo').value = '';
        document.getElementById('descripcion').value = '';
        cargarTareas();
      } catch (error) {
        mostrarAlerta('Error: ' + error.message, 'error');
      }
    }

    async function editarTarea(id) {
      const titulo = prompt('Nuevo titulo:');
      if (!titulo) return;
      const descripcion = prompt('Nueva descripcion:');
      if (!descripcion) return;

      try {
        const response = await fetch(`${API_URL}/tareas/${id}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ titulo, descripcion })
        });

        if (!response.ok) {
          const data = await response.json();
          throw new Error(data.error);
        }

        mostrarAlerta('Tarea actualizada', 'success');
        cargarTareas();
      } catch (error) {
        mostrarAlerta('Error: ' + error.message, 'error');
      }
    }

    async function eliminarTarea(id) {
      if (!confirm('Eliminar tarea?')) return;

      try {
        const response = await fetch(`${API_URL}/tareas/${id}`, {
          method: 'DELETE'
        });

        if (!response.ok) {
          const data = await response.json();
          throw new Error(data.error);
        }

        mostrarAlerta('Tarea eliminada', 'success');
        cargarTareas();
      } catch (error) {
        mostrarAlerta('Error: ' + error.message, 'error');
      }
    }

    cargarTareas();
  </script>
</body>
</html>
